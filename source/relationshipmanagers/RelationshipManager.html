<!DOCTYPE html><head><meta charset="UTF-8"><title>RelationshipManager | RACCOON</title><link rel="icon" type="image/x-icon" href="../../media/raccoon_icon.png" sizes="16x16 32x32 64x64 128x128"></link><link href="../../contrib/materialize/materialize.min.css" type="text/css" rel="stylesheet" media="screen,projection"></link><link href="../../contrib/prism/prism.min.css" type="text/css" rel="stylesheet"></link><link href="../../css/moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/devel_moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/alert_moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/content_moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/sqa_moose.css" type="text/css" rel="stylesheet"></link><script type="text/javascript" src="../../contrib/jquery/jquery.min.js"></script></head><body><div class="page-wrap"><header><nav><div class="nav-wrapper container"><a href="https://hugary1995.github.io/raccoon/index.html" class="left moose-logo hide-on-med-and-down">RACCOON</a><a href="https://github.com/hugary1995/raccoon" class="right"><img src="../../media/framework/github-logo.png" class="github-mark"></img><img src="../../media/framework/github-mark.png" class="github-logo"></img></a><ul class="right hide-on-med-and-down"><li><a href="#!" class="dropdown-trigger" data-target="781dd07a-efea-45d1-8cdf-355eaf97b405" data-constrainWidth="false">Getting Started<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="#!" class="dropdown-trigger" data-target="c26f352e-978d-4ee2-aecd-b090b583d2a7" data-constrainWidth="false">Tutorials<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="#!" class="dropdown-trigger" data-target="b4a84809-e72b-449a-8642-febda44d9305" data-constrainWidth="false">Theory<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="#!" class="dropdown-trigger" data-target="dde7d3a7-502b-4a94-83a9-3bd11584a6f5" data-constrainWidth="false">Documentation<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="../../contribute/index.html">Contribute</a></li></ul><a href="#" class="sidenav-trigger" data-target="69e4c13e-f16f-437a-82eb-e933e99fe3b7"><i class="material-icons">menu</i></a><ul class="sidenav" id="69e4c13e-f16f-437a-82eb-e933e99fe3b7"><li><a href="#!" class="dropdown-trigger" data-target="e05fea27-a521-4e54-8900-a98f6f74da04" data-constrainWidth="false">Getting Started<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="#!" class="dropdown-trigger" data-target="a998bd0c-e2e5-44ab-8e80-2d02995f068f" data-constrainWidth="false">Tutorials<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="#!" class="dropdown-trigger" data-target="91ab39d5-40ce-417e-8c21-d30490fc9a43" data-constrainWidth="false">Theory<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="#!" class="dropdown-trigger" data-target="83572dfd-aa09-4b5f-918b-138987c9f544" data-constrainWidth="false">Documentation<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="../../contribute/index.html">Contribute</a></li></ul><a href="#moose-search" class="modal-trigger"><i class="material-icons">search</i></a></div><ul class="dropdown-content" id="781dd07a-efea-45d1-8cdf-355eaf97b405"><li><a href="../../getting_started/install.html">Install RACCOON</a></li><li><a href="../../getting_started/update.html">Update RACCOON</a></li><li><a href="../../getting_started/ide.html">Code development</a></li><li><a href="../../getting_started/paraview.html">Visualization</a></li></ul><ul class="dropdown-content" id="c26f352e-978d-4ee2-aecd-b090b583d2a7"><li><a href="../../tutorials/01_small_deformation_elasticity.html">1. Small deformation</a></li><li><a href="../../tutorials/02_mode1_brittle_fracture.html">2. Mode-I fracture</a></li><li><a href="../../tutorials/03_mode2_brittle_fracture.html">3. Mode-II fracture</a></li><li><a href="../../tutorials/04_soil_desiccation.html">4. Soil desiccation</a></li><li><a href="../../tutorials/05_large_deformation_elasticity.html">5. Large deformation</a></li><li><a href="../../tutorials/06_elastoplasticity.html">6. Elastoplasticity</a></li><li><a href="../../tutorials/07_ductile_fracture.html">7. Ductile fracture</a></li><li><a href="../../tutorials/08_three_point_bending.html">8. Three-point bending</a></li></ul><ul class="dropdown-content" id="b4a84809-e72b-449a-8642-febda44d9305"><li><a href="../../theory/intro.html">Introduction</a></li><li><a href="../../theory/kinematics.html">State variables and kinematics</a></li><li><a href="../../theory/thermodynamics.html">Thermodynamics</a></li><li><a href="../../theory/minimization.html">The minimization problem</a></li><li><a href="../../theory/constitutive_models.html">Constitutive Models</a></li></ul><ul class="dropdown-content" id="dde7d3a7-502b-4a94-83a9-3bd11584a6f5"><li><a href="../../modules/index.html">Physics modules</a></li><li><a href="../../syntax/index.html">Complete syntax</a></li><li><a href="../../syntax/raccoon.html">RACCOON syntax</a></li><li><a href="../../syntax/tensor_mechanics.html">Tensor mechanics syntax</a></li><li><a href="../../syntax/phase_field.html">Phase field syntax</a></li><li><a href="../../syntax/heat_conduction.html">Heat conduction syntax</a></li></ul><ul class="dropdown-content" id="e05fea27-a521-4e54-8900-a98f6f74da04"><li><a href="../../getting_started/install.html">Install RACCOON</a></li><li><a href="../../getting_started/update.html">Update RACCOON</a></li><li><a href="../../getting_started/ide.html">Code development</a></li><li><a href="../../getting_started/paraview.html">Visualization</a></li></ul><ul class="dropdown-content" id="a998bd0c-e2e5-44ab-8e80-2d02995f068f"><li><a href="../../tutorials/01_small_deformation_elasticity.html">1. Small deformation</a></li><li><a href="../../tutorials/02_mode1_brittle_fracture.html">2. Mode-I fracture</a></li><li><a href="../../tutorials/03_mode2_brittle_fracture.html">3. Mode-II fracture</a></li><li><a href="../../tutorials/04_soil_desiccation.html">4. Soil desiccation</a></li><li><a href="../../tutorials/05_large_deformation_elasticity.html">5. Large deformation</a></li><li><a href="../../tutorials/06_elastoplasticity.html">6. Elastoplasticity</a></li><li><a href="../../tutorials/07_ductile_fracture.html">7. Ductile fracture</a></li><li><a href="../../tutorials/08_three_point_bending.html">8. Three-point bending</a></li></ul><ul class="dropdown-content" id="91ab39d5-40ce-417e-8c21-d30490fc9a43"><li><a href="../../theory/intro.html">Introduction</a></li><li><a href="../../theory/kinematics.html">State variables and kinematics</a></li><li><a href="../../theory/thermodynamics.html">Thermodynamics</a></li><li><a href="../../theory/minimization.html">The minimization problem</a></li><li><a href="../../theory/constitutive_models.html">Constitutive Models</a></li></ul><ul class="dropdown-content" id="83572dfd-aa09-4b5f-918b-138987c9f544"><li><a href="../../modules/index.html">Physics modules</a></li><li><a href="../../syntax/index.html">Complete syntax</a></li><li><a href="../../syntax/raccoon.html">RACCOON syntax</a></li><li><a href="../../syntax/tensor_mechanics.html">Tensor mechanics syntax</a></li><li><a href="../../syntax/phase_field.html">Phase field syntax</a></li><li><a href="../../syntax/heat_conduction.html">Heat conduction syntax</a></li></ul></nav><div class="modal modal-fixed-footer moose-search-modal" id="moose-search"><div class="modal-content container moose-search-modal-content"><div class="row"><div class="col l12"><div class="input-field"><input type_="text" onkeyup="mooseSearch()" placeholder="https://hugary1995.github.io/raccoon/index.html" id="moose-search-box"></input></div></div><div><div class="col s12" id="moose-search-results"></div></div></div></div><div class="modal-footer"><a href="#!" class="modal-close btn-flat">Close</a></div></div></header><main class="main"><div class="container"><div class="row"><div class="moose-content col s12 m12 l12"><section id="12af7924-f11c-4e38-a984-769fb68534a9" data-section-level="1" data-section-text="RelationshipManager"><h1 id="relationshipmanager">RelationshipManager</h1><p>The RelationshipManager system is for making MOOSE aware of extra geometric, algebraic, or coupling information needed to perform a calculation. This is an extension of the &quot;stencil&quot; concept when working with a structured mesh and performing calculations where you need neighboring information. Relationship managers (RMs) come in three flavors: geometric, algebraic, and coupling.  For discerning between the three types, we can think of three levels of &quot;element dependencies&quot;. An element K1 has a coupling dependency on element K2 if the dofs on K1 might need sparsity pattern entries for dofs on K2.  An element K1 has an algebraic dependency on K2 if a processor which owns K1 might need to examine the solution dof values on K2.  An element K1 has a geometric dependency on K2 if a processor which owns K1 might need to examine the geometry of K2. For any element K, we could call the set of coupling-ghosted (&quot;coupled&quot;) elements C(K), call the set of algebraic-ghosted (&quot;evaluable&quot;) elements E(K), and call the set of geometry-ghosted (&quot;ghosted&quot;) elements G(K). It should be safe to assume that, for any element K, C(K) implies E(K) implies G(K), meaning that a requirement for coupling ghosting means that algebraic and geometric ghosting will be required as well. As a more concrete example, it will be impossible to investigate the degrees of freedom on an element in the <code>libMesh::DofMap</code> if that element has been deleted from the current process, e.g. if we forgot to geometrically ghost the element. Hence geometrically ghosted elements must be a super-set of algebraically ghosted elements which must be a super-set of coupling-ghosted elements.</p><p>The RM system is fully pluggable like other MOOSE systems but it not intended to be exposed in the input file in any way. Instead, individual objects that require extra information should &quot;register&quot; an appropriate RM right in its <code>validParams</code> function and have MOOSE add the appropriate object to the simulation at the proper time. It is possible for a single RM to define geometric, algebraic, and coupling-ghosting, e.g like the RM defined for <code>DGKernelBase</code> derived-objects:</p><pre class="moose-pre"><code class="language-c++">
params.addRelationshipManager(&quot;ElementSideNeighborLayers&quot;,
                              Moose::RelationshipManagerType::GEOMETRIC |
                                  Moose::RelationshipManagerType::ALGEBRAIC |
                                  Moose::RelationshipManagerType::COUPLING);
</code></pre><p>An application developer should always respect the superset relationships discussed in the introductory paragraph, e.g. the following relationship manager additions would provide a valid ghosting set-up:</p><pre class="moose-pre"><code class="language-c++">
params.addRelationshipManager(
    &quot;ElementSideNeighborLayers&quot;,
    Moose::RelationshipManagerType::GEOMETRIC,
    [](const InputParameters &amp;, InputParameters &amp; rm_params) {
      rm_params.set&lt;unsigned short&gt;(&quot;layers&quot;) = 3;
    }
);
params.addRelationshipManager(
    &quot;ElementSideNeighborLayers&quot;,
    Moose::RelationshipManagerType::ALGEBRAIC,
    [](const InputParameters &amp;, InputParameters &amp; rm_params) {
      rm_params.set&lt;unsigned short&gt;(&quot;layers&quot;) = 2;
    }
);
params.addRelationshipManager(
    &quot;ElementSideNeighborLayers&quot;,
    Moose::RelationshipManagerType::COUPLING,
    [](const InputParameters &amp;, InputParameters &amp; rm_params) {
      rm_params.set&lt;unsigned short&gt;(&quot;layers&quot;) = 1;
    }
);
</code></pre><p>because any coupling-ghosted element is guaranteed to be algebraically ghosted, and each algebraically ghosted element is guaranteed to be geometrically ghosted (1 layer coupling ghosting &lt;= 2 layers algebraic ghosting &lt;= 3 layers geometric ghosting). The following set-up is also valid:</p><pre class="moose-pre"><code class="language-c++">
params.addRelationshipManager(&quot;ElementSideNeighborLayers&quot;,
                              Moose::RelationshipManagerType::GEOMETRIC |
                                  Moose::RelationshipManagerType::ALGEBRAIC |
                                  Moose::RelationshipManagerType::COUPLING);
</code></pre><p>because there is a (default) 1 layer of side ghosting for all ghosting types (1 layer coupling ghosting &lt;= 1 layer algebraic ghosting &lt;= 1 layer geometric ghosting). The following RM set-up would be <em></em>invalid**:</p><pre class="moose-pre"><code class="language-c++">
params.addRelationshipManager(
    &quot;ElementSideNeighborLayers&quot;,
    Moose::RelationshipManagerType::GEOMETRIC,
    [](const InputParameters &amp;, InputParameters &amp; rm_params) {
      rm_params.set&lt;unsigned short&gt;(&quot;layers&quot;) = 1;
    }
);
params.addRelationshipManager(
    &quot;ElementSideNeighborLayers&quot;,
    Moose::RelationshipManagerType::ALGEBRAIC,
    [](const InputParameters &amp;, InputParameters &amp; rm_params) {
      rm_params.set&lt;unsigned short&gt;(&quot;layers&quot;) = 2;
    }
);
</code></pre><p>because there is less geometric ghosting than algebraic. In this scenario we would likely attempt to access degrees of freedom in the solution vector corresponding to elements that had been deleted (in a <code>DistributedMesh</code> context), and our simulation would fail.</p><section id="6b64f588-f00a-45d4-8594-5dfedcfbc9fa" data-section-level="2" data-section-text="Relationship Managers and Actions"><h2 id="rm_action">Relationship Managers and Actions</h2><p>As explained above, <code>RelationshipManagers</code> are usually added to a simulation through the <code>validParams</code> of <code>MooseObjects</code>. However, during simulation setup, <code>MooseObjects</code> themselves do not add the relationship managers because if they did it would be too late to have any impact on the simulation...remote elements would already be deleted from the mesh because the mesh is prepared way before any <code>MooseObjects</code> are added (other than <code>MeshGenerators</code>). So it is the <code>MooseObjectAction</code> itself that detects whether a <code>MooseObject</code> (through its <code>validParams</code>) has signaled that it needs a relationship manager and adds it. However, if the <code>MooseObjectAction</code> is not adding the <code>MooseObject</code> , and the <code>MooseObject</code> is being added through a custom <code>action</code>, then that custom action has to be responsible for detecting and adding the associated relationship managers. The method that the custom <code>Action</code> should override to add relationsip managers is <code>addRelationshipManagers(Moose::RelationshipManagerType input_rm_type)</code>. Both the <code>ContactAction</code> in the contact module, and <code>PorousFlowActionBase</code> in the porous flow module provide examples of overriding this method. </p></section></section></div></div></div></main></div></body><script type="text/javascript" src="../../contrib/materialize/materialize.min.js"></script><script type="text/javascript" src="../../contrib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="../../contrib/prism/prism.min.js"></script><script type="text/javascript" src="../../js/init.js"></script><script type="text/javascript" src="../../js/navigation.js"></script><script type="text/javascript" src="../../contrib/fuse/fuse.min.js"></script><script type="text/javascript" src="../../js/search_index.js"></script><script type="text/javascript" src="../../js/sqa_moose.js"></script>